{% extends "AppBundle:layout:layout.html.twig" %}

{% block header %}
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                        aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">School App</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="{{ path('@BackendHome') }}">Dashboard</a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="{{ path('fos_user_security_logout') }}">Logout {{app.user.username}}</a>
                    </li>
                </ul>
            </div>
            <!--/.navbar-collapse -->
        </div>
    </nav>
{% endblock %}

{% block mainContent %}

    <style>
        .cg-url {
            width: 80%;
            margin-right: 10px;
            margin-bottom: 5px;
            margin-top: 5px;
        }

        .cg-anchorText {
            width: 10%;
            margin-right: 10px;
            margin-bottom: 5px;
            margin-top: 5px;
        }
    </style>
    <div class="container">

                 <h2>{{ heading }}</h2>
                {{ form_start(form) }}
                {{ form_errors(form) }}
                <div class="form-group">
                    {{ form_label(form.title) }}
                    {{ form_errors(form.title) }}
                    {{ form_widget(form.title, {'attr': {'class': 'form-control'} }) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.content) }}
                    {{ form_errors(form.content) }}
                    {{ form_widget(form.content, {'attr': {'class': 'form-control', 'rows':'5'} }) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.urls) }} <a id="add-another-url" href="#" class="btn btn-default btn-sm">Add
                        another
                        url</a>
                    <ul id="url-fields-list" data-prototype="{{ form_widget(form.urls.vars.prototype)|e }}">
                        <div id="url-anchor-text" class="hidden"
                             data-prototype="{{ form_widget(form.urlAnchorTexts.vars.prototype)|e }}"></div>
                        {% set i = 0 %}
                        {% for url in form.urls %}
                            <li>{{ form_errors(url) }}{{ form_widget(url, {'attr': {'class': 'cg-url'} }) }}{{ form_widget(form.urlAnchorTexts[i], {'attr': {'class': 'cg-anchorText', 'placeholder':'anchor text'} }) }}{% set i = i+1 %}</li>
                        {% endfor %}
                    </ul>
                </div>
                <div class="form-group">
                    <label>Grade</label>
                    <a id="checkAll" href="#" class="btn btn-default btn-sm">Check All</a>
                    <a id="unCheckAll" href="#" class="btn btn-default btn-sm">Uncheck All</a><br/>
                    {% for level1 in classTypeList %}
                        {% for classType in level1 %}
                            {{ form_label(attribute(form, classType)) }}
                            {{ form_errors(attribute(form, classType)) }}
                            {{ form_widget(attribute(form, classType), {'attr':{'class':'cgClassType' }}) }}
                        {% endfor %}
                        <br/>
                    {% endfor %}
                </div>
                <div class="form-group">
                    <label>Mode</label><br/>
                    {% for mode in modeList %}
                        {{ form_label(attribute(form, mode)) }}
                        {{ form_errors(attribute(form, mode)) }}
                        {{ form_widget(attribute(form, mode)) }}
                    {% endfor %}
                </div>
                <div class="form-group">
                    {{ form_label(form.visible) }}
                    {{ form_errors(form.visible) }}
                    {{ form_widget(form.visible, {'attr': {'class': 'form-control'} }) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.save) }}
                    {{ form_widget(form.save, {'attr': {'class': 'btn btn-primary'} }) }}
                    {{ form_label(form.saveAndPush) }}
                    {{ form_widget(form.saveAndPush, {'attr': {'class': 'btn btn-danger'} }) }}
                    <a href="{{ path('news_home') }}" class="btn btn-primary" style="float: right">Cancel</a>
                </div>
                {% do form.urls.setRendered %}
                {% do form.urlAnchorTexts.setRendered %}
                {{ form_end(form) }}
         </div>

    {% block footer %}
        <div class="container">
            {{ parent() }}
        </div>
    {% endblock %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        // keep track of how many email fields have been rendered
        var urlCount = '{{ form.urls|length }}';

        jQuery(document).ready(function () {
            var addDeleteTag = function (liObj) {
                var removeFormA = jQuery('<a href="#" class="btn btn-default btn-sm">X</a>');
                liObj.append(removeFormA);

                removeFormA.on('click', function (e) {
                    e.preventDefault();
                    liObj.remove();
                });
            }
            var updateDeleteListionser = function () {
                var collectionHolder = jQuery('#url-fields-list');
                collectionHolder.find('li').each(function () {
                    addDeleteTag($(this));
                });
            }
            updateDeleteListionser();
            jQuery('#add-another-url').click(function (e) {
                e.preventDefault();

                var urlList = jQuery('#url-fields-list');
                var newWidget = urlList.attr('data-prototype');
                var newAnchorText = jQuery('#url-anchor-text').attr('data-prototype');
                newWidget = newWidget.replace(/__name__/g, urlCount);
                newAnchorText = newAnchorText.replace(/__name__/g, urlCount);
                urlCount++;
                var newLi = jQuery('<li></li>').html(newWidget);
                newLi.append(newAnchorText);
                newLi.children().first().addClass('cg-url');
                newLi.children().first().attr('placeholder', 'url');
                newLi.children().first().next().addClass('cg-anchorText');
                newLi.children().first().next().attr('placeholder', 'anchor text');
                addDeleteTag(newLi);
                newLi.appendTo(urlList);
            });
            jQuery('#checkAll').click(function (e) {
                e.preventDefault();

                jQuery('.cgClassType').each(function (index) {
                    jQuery(this).prop('checked', true);
                });
            });
            jQuery('#unCheckAll').click(function (e) {
                e.preventDefault();

                jQuery('.cgClassType').each(function (index) {
                    jQuery(this).prop('checked', false);
                });
            });
        })
    </script>
{% endblock %}